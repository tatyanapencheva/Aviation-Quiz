<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1 id="title">Quiz</h1>
</header>

<main>
  <div class="card">

    <p id="progress"></p>
    <p id="score"></p>

    <p id="question">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ‚Ä¶</p>

    <button id="showBtn" class="show" onclick="showAnswer()">
      –ü–æ–∫–∞–∂–∏ –æ—Ç–≥–æ–≤–æ—Ä
    </button>

    <p id="answer"></p>

    <div class="actions">
      <button id="knowBtn" class="know" onclick="markKnown(true)">–ó–Ω–∞–º</button>
      <button id="dontKnowBtn" class="dontknow" onclick="markKnown(false)">–ù–µ –∑–Ω–∞–º</button>
    </div>

    <div id="endButtons" class="end" style="display:none;">
      <button onclick="repeatGroup()">–ü–æ–≤—Ç–æ—Ä–∏ —Ç–∞–∑–∏ –≥—Ä—É–ø–∞</button>
      <button onclick="nextGroup()">–°–ª–µ–¥–≤–∞—â–∞ –≥—Ä—É–ø–∞</button>
    </div>

    <ul id="wrongList"></ul>

  </div>
</main>

<script>
/* ==== –ß–ï–¢–ï–ú –ü–ê–†–ê–ú–ï–¢–†–ò–¢–ï –û–¢ –ú–ï–ù–Æ–¢–û ==== */
const params = new URLSearchParams(window.location.search);
const quizTitle = params.get("title");
const jsonFile = params.get("file");

if (!quizTitle || !jsonFile) {
  document.getElementById("question").textContent =
    "‚ùå –ì—Ä–µ—à–∫–∞: –ª–∏–ø—Å–≤–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ç–µ—Å—Ç–∞.";
  throw new Error("Missing quiz parameters");
}

document.getElementById("title").textContent = quizTitle;

/* ==== –ü–†–û–ú–ï–ù–õ–ò–í–ò ==== */
let allQuestions = [];
let currentGroupQuestions = [];
let group = 0;
let index = 0;
let wrong = [];
let correct = 0;

const GROUP_SIZE = 50;
let TOTAL_GROUPS = 0;

/* ==== –ó–ê–†–ï–ñ–î–ê–ù–ï –ù–ê –í–™–ü–†–û–°–ò–¢–ï ==== */
fetch(jsonFile)
  .then(r => {
    if (!r.ok) throw new Error("Cannot load JSON");
    return r.json();
  })
  .then(data => {
    allQuestions = data;
    TOTAL_GROUPS = Math.ceil(allQuestions.length / GROUP_SIZE);
    loadGroup();
  })
  .catch(() => {
    document.getElementById("question").textContent =
      "‚ùå –ù–µ—É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ.";
  });

/* ==== –ü–û–ú–û–©–ù–ò –§–£–ù–ö–¶–ò–ò ==== */
function shuffle(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function loadGroup() {
  const start = group * GROUP_SIZE;
  const end = start + GROUP_SIZE;

  currentGroupQuestions = shuffle(allQuestions.slice(start, end));

  index = 0;
  wrong = [];
  correct = 0;

  document.getElementById("endButtons").style.display = "none";
  document.getElementById("wrongList").innerHTML = "";

  showControls();
  loadQuestion();
}

function loadQuestion() {
  if (index >= currentGroupQuestions.length) {
    finishGroup();
    return;
  }

  const q = currentGroupQuestions[index];

  document.getElementById("progress").textContent =
    `–ß–∞—Å—Ç ${group + 1} –æ—Ç ${TOTAL_GROUPS} ‚Äì –í—ä–ø—Ä–æ—Å ${index + 1} –æ—Ç ${currentGroupQuestions.length}`;

  document.getElementById("score").textContent =
    `–í–µ—Ä–Ω–∏: ${correct} / ${currentGroupQuestions.length}`;

  document.getElementById("question").textContent = q.question;
  document.getElementById("answer").textContent = q.answer;
  document.getElementById("answer").style.display = "none";
}

function showAnswer() {
  document.getElementById("answer").style.display = "block";
}

function markKnown(known) {
  if (known) {
    correct++;
  } else {
    wrong.push(currentGroupQuestions[index]);
  }
  index++;
  loadQuestion();
}

function finishGroup() {
  document.getElementById("progress").textContent = "";
  document.getElementById("question").textContent =
    `–ö—Ä–∞–π –Ω–∞ —á–∞—Å—Ç ${group + 1} ‚úîÔ∏è`;

  document.getElementById("score").textContent =
    `–†–µ–∑—É–ª—Ç–∞—Ç: ${correct} / ${currentGroupQuestions.length}`;

  hideControls();
  document.getElementById("endButtons").style.display = "flex";

  const list = document.getElementById("wrongList");
  list.innerHTML = "";

  if (wrong.length === 0) {
    list.innerHTML = "<li>üéâ –ù—è–º–∞ –≥—Ä–µ—à–Ω–∏ –≤—ä–ø—Ä–æ—Å–∏!</li>";
  } else {
    wrong.forEach(q => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${q.question}</strong><br>${q.answer}`;
      list.appendChild(li);
    });
  }
}

function repeatGroup() {
  loadGroup();
}

function nextGroup() {
  if (group < TOTAL_GROUPS - 1) {
    group++;
    loadGroup();
  } else {
    document.getElementById("question").textContent =
      "üéâ –ì–æ—Ç–æ–≤–æ! –í—Å–∏—á–∫–∏ –≤—ä–ø—Ä–æ—Å–∏ —Å–∞ –º–∏–Ω–∞—Ç–∏.";
    document.getElementById("score").textContent = "";
    document.getElementById("endButtons").style.display = "none";
    document.getElementById("wrongList").innerHTML = "";
  }
}

function hideControls() {
  document.getElementById("showBtn").style.display = "none";
  document.getElementById("knowBtn").style.display = "none";
  document.getElementById("dontKnowBtn").style.display = "none";
  document.getElementById("answer").style.display = "none";
}

function showControls() {
  document.getElementById("showBtn").style.display = "inline-block";
  document.getElementById("knowBtn").style.display = "inline-block";
  document.getElementById("dontKnowBtn").style.display = "inline-block";
}
</script>

</body>
</html>
