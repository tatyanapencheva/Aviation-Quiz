<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1 id="quizTitle">Quiz</h1>
</header>

<main>
  <div class="card">

    <p id="progress"></p>
    <p id="score"></p>

    <p id="question">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ‚Ä¶</p>

    <button id="showBtn" class="show" onclick="showAnswer()">–ü–æ–∫–∞–∂–∏ –æ—Ç–≥–æ–≤–æ—Ä</button>

    <p id="answer"></p>

    <div class="actions">
      <button id="knowBtn" class="know" onclick="markKnown(true)">–ó–Ω–∞–º</button>
      <button id="dontKnowBtn" class="dontknow" onclick="markKnown(false)">–ù–µ –∑–Ω–∞–º</button>
    </div>

    <div id="endButtons" class="end" style="display:none;">
      <button onclick="repeatGroup()">üîÅ –ü–æ–≤—Ç–æ—Ä–∏ –≥—Ä—É–ø–∞—Ç–∞</button>
      <button onclick="nextGroup()">‚ñ∂Ô∏è –°–ª–µ–¥–≤–∞—â–∞ –≥—Ä—É–ø–∞</button>
      <button onclick="goToMenu()">üè† –ö—ä–º –º–µ–Ω—é—Ç–æ</button>
    </div>

    <ul id="wrongList"></ul>

  </div>
</main>

<script>
let allQuestions = [];
let currentGroupQuestions = [];
let index = 0;
let correct = 0;
let wrong = [];

let groupIndex = 0;

const GROUP_SIZE = 50;

// üîπ –î–∞–Ω–Ω–∏ –æ—Ç –º–µ–Ω—é—Ç–æ
const title = localStorage.getItem("quizTitle");
const file = localStorage.getItem("quizFile");

document.getElementById("quizTitle").textContent = title || "Quiz";

if (!file) {
  document.getElementById("question").textContent =
    "‚ùå –ù—è–º–∞ –∏–∑–±—Ä–∞–Ω –ø—Ä–µ–¥–º–µ—Ç.";
  hideControls();
} else {
  fetch(file)
    .then(r => r.json())
    .then(data => {
      allQuestions = data;
      loadGroup();
    })
    .catch(() => {
      document.getElementById("question").textContent =
        "‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏—Ç–µ.";
      hideControls();
    });
}

function shuffle(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function loadGroup() {
  const start = groupIndex * GROUP_SIZE;
  const end = start + GROUP_SIZE;

  currentGroupQuestions = shuffle(
    allQuestions.slice(start, end)
  );

  index = 0;
  correct = 0;
  wrong = [];

  document.getElementById("endButtons").style.display = "none";
  document.getElementById("wrongList").innerHTML = "";

  showControls();
  loadQuestion();
}

function loadQuestion() {
  if (index >= currentGroupQuestions.length) {
    finishGroup();
    return;
  }

  const q = currentGroupQuestions[index];

  document.getElementById("progress").textContent =
    `–ì—Ä—É–ø–∞ ${groupIndex + 1} | –í—ä–ø—Ä–æ—Å ${index + 1} –æ—Ç ${currentGroupQuestions.length}`;

  document.getElementById("score").textContent =
    `–í–µ—Ä–Ω–∏: ${correct}`;

  document.getElementById("question").textContent = q.question;
  document.getElementById("answer").textContent = q.answer;
  document.getElementById("answer").style.display = "none";
}

function showAnswer() {
  document.getElementById("answer").style.display = "block";
}

function markKnown(known) {
  if (known) correct++;
  else wrong.push(currentGroupQuestions[index]);

  index++;
  loadQuestion();
}

function finishGroup() {
  document.getElementById("question").textContent =
    `–ö—Ä–∞–π –Ω–∞ –≥—Ä—É–ø–∞ ${groupIndex + 1} ‚úîÔ∏è`;

  document.getElementById("score").textContent =
    `–†–µ–∑—É–ª—Ç–∞—Ç: ${correct} / ${currentGroupQuestions.length}`;

  hideControls();
  document.getElementById("endButtons").style.display = "flex";

  const list = document.getElementById("wrongList");
  list.innerHTML = "";

  wrong.forEach(q => {
    const li = document.createElement("li");
    li.innerHTML = `<strong>${q.question}</strong><br>${q.answer}`;
    list.appendChild(li);
  });
}

function repeatGroup() {
  loadGroup();
}

function nextGroup() {
  const totalGroups = Math.ceil(allQuestions.length / GROUP_SIZE);

  if (groupIndex < totalGroups - 1) {
    groupIndex++;
    loadGroup();
  } else {
    document.getElementById("question").textContent =
      "üéâ –í—Å–∏—á–∫–∏ –≥—Ä—É–ø–∏ —Å–∞ –∑–∞–≤—ä—Ä—à–µ–Ω–∏!";
    document.getElementById("endButtons").style.display = "none";
    document.getElementById("wrongList").innerHTML = "";
  }
}

function goToMenu() {
  window.location.href = "index.html";
}

function hideControls() {
  document.getElementById("showBtn").style.display = "none";
  document.getElementById("knowBtn").style.display = "none";
  document.getElementById("dontKnowBtn").style.display = "none";
  document.getElementById("answer").style.display = "none";
}

function showControls() {
  document.getElementById("showBtn").style.display = "inline-block";
  document.getElementById("knowBtn").style.display = "inline-block";
  document.getElementById("dontKnowBtn").style.display = "inline-block";
}
</script>

</body>
</html>
